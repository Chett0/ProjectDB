<div class="routes-page">
    <div class="routes-header-row">
        <span class="routes-header-title">Gestione Tratte</span>
        <div class="routes-search-box">
            <input type="text" [formControl]="searchControl" placeholder="Cerca..." class="routes-search-input" />
        </div>
        <button class="add-route-btn" (click)="showAddModal = true">+ Aggiungi Tratta</button>
    </div>

    <!-- Modale aggiunta tratta -->
    <div *ngIf="showAddModal" class="routes-modal-backdrop">
        <div class="routes-modal">
            <button class="routes-modal-close" (click)="showAddModal = false" aria-label="Chiudi">&times;</button>
            <form [formGroup]="addRouteForm" (ngSubmit)="addRoute()" class="routes-add-form" autocomplete="off">
                <h3>Aggiungi nuova tratta</h3>
                <div class="routes-form-fields">
                    <input type="text" formControlName="departure_airport" maxlength="3" placeholder="Partenza (ICAO/IATA)" />
                    <input type="text" formControlName="arrival_airport" maxlength="3" placeholder="Arrivo (ICAO/IATA)" />
                </div>
                <div class="routes-validation">
                    <div *ngIf="addRouteForm.get('departure_airport')?.touched && addRouteForm.get('departure_airport')?.invalid">Partenza richiesta (max 3 caratteri).</div>
                    <div *ngIf="addRouteForm.get('arrival_airport')?.touched && addRouteForm.get('arrival_airport')?.invalid">Arrivo richiesto (max 3 caratteri).</div>
                </div>
                <button type="submit" [disabled]="submitting">{{ submitting ? 'Aggiungo...' : 'Aggiungi tratta' }}</button>
            </form>
        </div>
    </div>

    <section class="routes-list-section">
        <div *ngIf="loading" class="routes-loading">Caricamento...</div>
        <div *ngIf="errorMessage" class="routes-error">{{ errorMessage }}</div>
                <div *ngIf="!loading && filteredRoutes.length">
                    <div class="routes-grid">
                        <div class="route-label" *ngFor="let route of filteredRoutes; trackBy: trackByRoute">
                            <div class="route-label-inner">
                                <div class="route-airports">
                                    <span class="route-airport">
                                        <span class="route-airport-code">{{ route.departure_airport.code || route.departure_airport }}</span>
                                        <span class="route-airport-name">{{ route.departure_airport.name ? ' - ' + route.departure_airport.name : '' }}</span>
                                    </span>
                                    <span class="route-arrow">â†’</span>
                                    <span class="route-airport">
                                        <span class="route-airport-code">{{ route.arrival_airport.code || route.arrival_airport }}</span>
                                        <span class="route-airport-name">{{ route.arrival_airport.name ? ' - ' + route.arrival_airport.name : '' }}</span>
                                    </span>
                                </div>
                                <button type="button" class="btn danger route-delete-btn" (click)="deleteRoute(route)">Elimina</button>
                            </div>
                        </div>
                    </div>
                </div>
    <div *ngIf="!loading && !filteredRoutes.length" class="routes-empty">Nessuna tratta trovata.</div>
    </section>
</div>
