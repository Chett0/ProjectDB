<app-header></app-header>

<section class="greeting">
	<div class="greeting-inner">
		<div class="greeting-icon" aria-hidden="true">
			<div class="greeting-avatar">{{ (passenger.name.charAt(0) + passenger.surname.charAt(0)).toUpperCase() }}</div>
		</div>
		<div class="greeting-text">
			<h2 class="greeting-title">Ciao, {{ passenger.name }}!</h2>
			<p class="greeting-sub">Benvenuto nella tua dashboard</p>
		</div>
	</div>
</section>

<div class="stats-grid">
	<div class="stat-card">
		<div class="stat-icon">‚úàÔ∏è</div>
		<div class="stat-body">
			<div class="stat-title">Voli Totali</div>
			<div class="stat-value">{{ totalFlights }}</div>
		</div>
	</div>

	<div class="stat-card">
		<div class="stat-icon">‚è±Ô∏è</div>
		<div class="stat-body">
			<div class="stat-title">Ore di Volo</div>
			<div class="stat-value">{{ flightHoursDisplay }}</div>
		</div>
	</div>

	<div class="stat-card">
		<div class="stat-icon">üí∂</div>
		<div class="stat-body">
			<div class="stat-title">Spesa Biglietti</div>
			<div class="stat-value">{{ moneySpent | currency:'EUR':'symbol':'1.0-0':'it-IT' }}</div>
		</div>
	</div>
</div>

<div class="profile-and-actions">
	<section class="personal-card">
    
	<h2>Informazioni Personali</h2>
	<div class="card">
		<div class="row">
			<div class="col">
				<label class="label">Nome</label>
				<div *ngIf="!editing" class="value">{{ passenger.name }}</div>
				<div *ngIf="editing">
					<input class="form-input" type="text" [(ngModel)]="editName" maxlength="50" />
				</div>
			</div>
			<div class="col">
				<label class="label">Cognome</label>
				<div *ngIf="!editing" class="value">{{ passenger.surname }}</div>
				<div *ngIf="editing">
					<input class="form-input" type="text" [(ngModel)]="editSurname" maxlength="50" />
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col">
				<label class="label">Email</label>
				<div class="value">{{ passenger.email }}</div>
			</div>
		</div>

		<div class="row settings-actions">
			<div class="col">
				<button class="btn btn--change" *ngIf="!editing" (click)="startEdit()">
					<svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
						<path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z" fill="#0b63ff" />
						<path d="M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" fill="#0b63ff" />
					</svg>
					<span class="btn-label">Modifica</span>
				</button>
				<button class="btn btn--primary" *ngIf="editing" (click)="saveEdit()">Salva</button>
				<button class="btn btn--ghost" *ngIf="editing" (click)="cancelEdit()">Annulla</button>
				<div class="message" *ngIf="message">{{ message }}</div>
			</div>
		</div>
	</div>
	</section>

	<aside class="quick-actions">
		<h3>Azioni Rapide</h3>
		<div class="qa-list">
			<button class="qa-btn qa-primary" (click)="onSearch()">
				<span class="qa-icon">‚úàÔ∏è</span>
				<span class="qa-label">Cerca Nuovo Volo</span>
			</button>

			<button class="qa-btn qa-outline" (click)="startEdit()">
				<span class="qa-icon">üë§</span>
				<span class="qa-label">Modifica Profilo</span>
			</button>

			<button class="qa-btn qa-danger" (click)="onLogout()">
				<span class="qa-icon">‚èèÔ∏è</span>
				<span class="qa-label">Esci</span>
			</button>
		</div>
	</aside>
</div>

<section class="tickets-list">
	   <h2>I tuoi biglietti</h2>
	   <div class="tickets">
		   <div *ngIf="tickets.length === 0" class="no-tickets-message">
			   Nessun biglietto disponibile
		   </div>
		   <div *ngFor="let t of tickets" class="ticket-card">
			   <div class="ticket-left">
				   <div class="ticket-head">
					   <div class="airline">‚úàÔ∏è {{ t.code }} - {{ t.airline }}</div>
					   <div class="booking">Prenotazione: {{ t.booking }}</div>
				   </div>

				   <div class="ticket-body">
					   <div class="col-stop">
						   <div class="code">{{ t.from.code }}</div>
						   <div class="city">{{ t.from.city }}</div>
						   <div class="time">{{ t.from.time }}</div>
						   <div class="date">{{ t.from.date }}</div>
					   </div>

					   <div class="journey">
						   <div class="plane">{{ t.cabin }}</div>
					   </div>

					   <div class="col-stop">
						   <div class="code">{{ t.to.code }}</div>
						   <div class="city">{{ t.to.city }}</div>
						   <div class="time">{{ t.to.time }}</div>
						   <div class="date">{{ t.to.date }}</div>
					   </div>
				   </div>

				   <div class="ticket-foot">
					   <div class="seat">Posto: {{ t.seat }}</div>
				   </div>
				   <div class="ticket-extras">
				<button class="extras-toggle" (click)="toggleExtras(t.id)">
					Extra di volo
					<span [class.open]="extrasMap.get(t.id)?.show">‚ñº</span>
				</button>

				<div class="extras-dropdown" *ngIf="extrasMap.get(t.id)?.show">
					<div *ngIf="extrasMap.get(t.id)?.extras?.length; else noExtras">
					<div class="extra-item" *ngFor="let e of extrasMap.get(t.id)?.extras">
						<span class="extra-name">{{ e.name }}</span>
						<span class="extra-price">{{ e.price }}‚Ç¨</span>
					</div>
					</div>

					<ng-template #noExtras>
					<div class="extra-empty">Nessun extra selezionato</div>
					</ng-template>
				</div>
				</div>
			   </div>

			   <div class="ticket-right">
				   <div class="price">{{ t.price }}‚Ç¨</div>
			   </div>
		   </div>
	   </div>
</section>

	<!-- Paginatore biglietti -->
	<div class="tickets-paginator mt-3" *ngIf="ticketsTotal > ticketsLimit" style="display:flex;justify-content:center;">
		<div class="d-flex align-items-center">
			<button class="btn btn-sm btn-outline-primary me-2" (click)="prevTicketsPage()" [disabled]="ticketsPage <= 1">Prev</button>

			<ng-container *ngFor="let p of getVisibleTicketPages(); let i = index">
				<ng-container *ngIf="p === '...'; else tBtn">
					<span class="mx-1">&hellip;</span>
				</ng-container>
				<ng-template #tBtn>
					<button class="btn btn-sm me-1" [ngClass]="{'btn-primary': ticketsPage === (+p), 'btn-outline-secondary': ticketsPage !== (+p)}" (click)="setTicketsPage(+p)">{{ p }}</button>
				</ng-template>
			</ng-container>

			<button class="btn btn-sm btn-outline-primary ms-2" (click)="nextTicketsPage()" [disabled]="ticketsPage >= getTicketsTotalPages()">Next</button>
		</div>
	</div>

<div class="passenger-page">
		<app-footer></app-footer>
</div>
	

